---
title: "Final Project Markdown"
author: "Carly Gottorff"
date: "November 27, 2018"
output: html_document
---

```{r}
library("RSQLite")

#Connect to data 
db <- dbConnect(SQLite(),"C:/Users/cgott/Documents/ST449/Datasets/database.sqlite")
## list all tables
tables <- dbListTables(db)
#Creating DF for each table
Country <- dbGetQuery(db,"Select * from Country") 
League <- dbGetQuery(db,"Select * from League")
Match <- dbGetQuery(db,"Select * from Match")
Player <- dbGetQuery(db,"Select * from Player")
Player_Attributes <- dbGetQuery(db,"Select * from Player_Attributes")
Team <- dbGetQuery(db,"Select * from Team")
Team_Attributes <- dbGetQuery(db,"Select * from Team_Attributes")

```


```{r}
#Data Cleaning
yearSplit=Match[Match$season=="2015/2016",] #Extracting just the data for the 2015/2016 season 
print(yearSplit[1:10,])

#extracting data by English league 
leagueSplit<-dbGetQuery(db, "SELECT  league_id, season, home_team_api_id, 
            away_team_api_id, home_team_goal, away_team_goal, team_api_id, team_long_name
           FROM Match JOIN Team
            ON Match.home_team_api_id= Team.team_api_id
           WHERE league_id='1729'")
#counting number of games in each season for English league
table(leagueSplit$season)
#counting number of games played by each English team 
gamesplayed<-dbGetQuery(db, "SELECT  league_id, home_team_api_id, team_api_id, team_long_name, COUNT(*)
           FROM Match JOIN Team
            ON Match.home_team_api_id= Team.team_api_id
           WHERE league_id='1729'
           GROUP BY team_api_id")

#creating outcome varibale for win, lose, tie
for (i in 1:nrow(leagueSplit)){
  if(leagueSplit$home_team_goal[i]==leagueSplit$away_team_goal[i]){
    leagueSplit$outcome[i]<-"Tie"
  }
  if(leagueSplit$home_team_goal[i]>leagueSplit$away_team_goal[i]){
    leagueSplit$outcome[i]<-"Win"
  }
  if(leagueSplit$home_team_goal[i]<leagueSplit$away_team_goal[i]){
    leagueSplit$outcome[i]<-"Lose"
  }
}

#need to do: 
#create varible to negate season

#create varible for counting number of win lose tie for each team
leagueTable<-data.frame(table(leagueSplit$team_long_name))
for(i in 1:length(leagueSplit)){
  if (leagueSplit$outcome[i] == "Win"){
    if(leagueSplit$team_long_name==leagueTable$Var1){
      leagueTable$win=+1
    }
  }
  if(leagueSplit $outcome[i] =="Lose"){
    leagueTable$lose+1
  }
  if(leagueSplit$outcome[i] =="Tie"){
    leagueTable$tie+1
  }
}

teamMerge<-merge(leagueSplit, Team_Attributes, by="team_api_id")
teamMerge<-teamMerge[!is.na(teamMerge$outcome),]


```


```{r}
#splitting data into training, testing
set.seed(1234)
train = sample(x = 3040, size = 1520)



```


